@{
    ViewData["Title"] = "Lịch sử ";
}



<div class="container">
    <div id="Viewer" class="imgPreview">
        <img id="imgPrev" src="@ViewBag.Ip" class="img-responsive" style="max-width: 100%;" alt="LIVE! Sever Screen Now!" />
        <br />
    </div>
</div>

<script src="~/lib/jquery-3.3.1.min.js"></script>

<style>

    h4 {
        padding-top: 15px;
        padding-bottom: 10px;
    }

    .pNew {
        padding-top: 12px;
    }

    .col-right {
        text-align: right;
    }
</style>
<style>
    /* Style for the table */
    table {
        width: 100%;
        border-collapse: collapse;
        border-spacing: 0;
    }

    /* Style for table header */
    th {
        background-color: #f2f2f2;
        color: #333;
        padding: 8px;
        text-align: left;
    }

    /* Style for table rows */
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    /* Style for table cells */
    td {
        padding: 8px;
        border-bottom: 1px solid #ddd;
    }

    /* Hover effect for table rows */
    tr:hover {
        background-color: #f2f2f2;
    }
</style>

<script>

    var refreshInterval = 500;
    var isWatching = true;
    var serverFailCount = 0;
    var ImagePreview = document.getElementById('imgPrev');
    // var viewer = document.getElementById('serverStoppedMessage');

    function LoadImage() {
        setTimeout(function () {
            // viewer.className = 'd-none';
            ImagePreview.className = 'img-responsive';
            ImagePreview.src = '@ViewBag.Ip' + '?rand=' + Math.random();
        }, refreshInterval);
    }

    ImagePreview.onload = function () {
        if (isWatching) {
            serverFailCount = 0;
            LoadImage();
        }
    };

    var checkServerStatusInterval;

    ImagePreview.onerror = function (err) {
        console.log(err);
        serverFailCount++;
        if (serverFailCount >= 5) {
            //viewer.className = '';
            ImagePreview.className = 'img-responsive d-none';
            checkServerStatusInterval = setInterval(function () {
                fetch('@ViewBag.Ip', {
                    "method": "GET",
                }).then(function (success) {
                    clearInterval(checkServerStatusInterval);
                    LoadImage();
                });
            }, 3000);
        }
        else
            LoadImage();
    }

    // var btn = document.getElementById('btnStartStop');

    // btn.onclick = function () {
    //     if (btn.getAttribute('data-state') == 'stop') {
    //         btn.setAttribute('data-state', 'start');
    //         btn.className = 'btn btn-primary';
    //         btn.querySelector('#stop').className = 'd-none';
    //         btn.querySelector('#play').className = '';
    //         isWatching = false;
    //     } else {
    //         btn.setAttribute('data-state', 'stop');
    //         btn.className = 'btn btn-danger';
    //         btn.querySelector('#stop').className = '';
    //         btn.querySelector('#play').className = 'd-none';
    //         isWatching = true;
    //         ImagePreview.src = 'http://127.0.0.1:54653/ScreenTask.jpg?rand=' + Math.random();

    //     }

    // };

    // var btnSetTimer = document.getElementById('btnSetTimer');


    // btnSetTimer.onclick = function () {
    //     var txtInterval = document.getElementById('txtInterval');
    //     refreshInterval = txtInterval.value;

    // };

    // var lnkAbout = document.getElementById('lnkAbout');
    // var msgAbout = document.getElementById('msgAbout');
    // var closeAbout = document.getElementById('closeAbout');
    // lnkAbout.onclick = function () {

    //     msgAbout.className = "alert alert-info alert-dismissable mt-2";
    // };
    // closeAbout.onclick = function () {
    //     msgAbout.className = "alert alert-info alert-dismissable d-none mt-2";
    // };

    // function requestFullScreen(element) {
    //     // Supports most browsers and their versions.
    //     var requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen;

    //     if (requestMethod) { // Native full screen.
    //         requestMethod.call(element);
    //     } else if (typeof window.ActiveXObject !== "undefined") { // Older IE.
    //         var wscript = new ActiveXObject("WScript.Shell");
    //         if (wscript !== null) {
    //             wscript.SendKeys("{F11}");
    //         }
    //     }
    // }

    // var btnFullscreen = document.getElementById('btnFullscreen');
    // btnFullscreen.onclick = function () {

    //     var viewer = document.getElementById('Viewer');
    //     requestFullScreen(viewer);
    // };



</script>

